<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PRS: Second part</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PRS
   </div>
   <div id="projectbrief">System programming project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('second_part_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Second part </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md21">Retrieve information</a><ul><li class="level2"><a href="#autotoc_md22">Width of a map</a></li>
<li class="level2"><a href="#autotoc_md23">Height of a map</a></li>
<li class="level2"><a href="#autotoc_md24">Number of tiles</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md25">Modify the map</a><ul><li class="level2"><a href="#autotoc_md26">Width of a map</a></li>
<li class="level2"><a href="#autotoc_md27">Height of a map</a></li>
<li class="level2"><a href="#autotoc_md28">Replace tiles</a></li>
<li class="level2"><a href="#autotoc_md29">Remove tiles</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md30">Command line parsers</a></li>
<li class="level1"><a href="#autotoc_md31">Potential improvements</a></li>
</ul>
</div>
<div class="textblock"><p>The second part of the project is dedicated to the development of the <code>maputil</code> utility program capable of modifying map archives.</p>
<p>This program is located under the <code>util</code> directory.</p>
<p>This utility program allows to:</p>
<ul>
<li>Get the width of a map;</li>
<li>Get the height of a map;</li>
<li>Get the number of tiles used in a map;</li>
<li>Set the width of a map;</li>
<li>Set the height of a map;</li>
<li>Replace the tiles of a map;</li>
<li>Remove unused tiles.</li>
</ul>
<p>The specifications of a map archive having been stated in the previous page, it is fairly easy to implement the operations mentioned above.</p>
<p>All operations that allow to modify a map result in the creation of a copy of the map archive under the form <code>&lt;filename&gt;-DD-MM-YYYY-hh:mm:ss</code> where:</p>
<ul>
<li><code>DD</code> corresponds to the current day;</li>
<li><code>MM</code> corresponds to the current month;</li>
<li><code>YYYY</code> corresponds to the current year;</li>
<li><code>hh</code> corresponds to the current hour;</li>
<li><code>mm</code> corresponds to the current minute;</li>
<li><code>ss</code> corresponds to the current second.</li>
</ul>
<p>See the <a class="el" href="group__util__group.html">utility</a> module for more information.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Retrieve information</h1>
<h2><a class="anchor" id="autotoc_md22"></a>
Width of a map</h2>
<p>The width of a map is located just after the signature of the map header.</p>
<p>It is needed to retrieve the location of the first map by reading four bytes from the twelfth byte of the map archive.</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="getwidth.svg" style="pointer-events: none;"></object>
<div class="caption">
Width of a map</div></div>
   <h2><a class="anchor" id="autotoc_md23"></a>
Height of a map</h2>
<p>This process is analogous to the recovery of the width of a map.</p>
<p>The height of a map is located just after its width.</p>
<p>It is needed to retrieve the location of the first map by reading four bytes from the twelfth byte of the map archive.</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="getheight.svg" style="pointer-events: none;"></object>
<div class="caption">
Height of a map</div></div>
   <h2><a class="anchor" id="autotoc_md24"></a>
Number of tiles</h2>
<p>The number of tiles used by a map is located just after the signature of the map archive.</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="getobjects.svg" style="pointer-events: none;"></object>
<div class="caption">
Number of tiles</div></div>
   <p>Note that for now an archive contains only one map. However, in the future, it could contain more. So, this information will not represent the number of tiles of the map anymore, but the total number of tiles used by the different maps of the archive.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Modify the map</h1>
<h2><a class="anchor" id="autotoc_md26"></a>
Width of a map</h2>
<p>Modifying the width of a map will alter its right side. A larger width expands the map from the right side and adds empty and transparent tiles, while a smaller width removes a part of the right side of the map causing a loss of tiles.</p>
<p>The width of a map is located just after the signature of the map header.</p>
<p>It is first needed to retrieve the location of the first map by reading four bytes from the twelfth byte of the map archive. Next, the width and the size of the map, located after the the height of the map, are updated. Finally, the map is shrunken or expanded according to the provided width.</p>
<p>When the map is expanded, transparent tiles are inserted (see <a class="el" href="maputil_8h.html#a2633b4496fbb7c588fbfd67aec48b686">MAP_OBJECT_NONE</a>).</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="setwidth.svg" style="pointer-events: none;"></object>
<div class="caption">
Width of a map</div></div>
   <h2><a class="anchor" id="autotoc_md27"></a>
Height of a map</h2>
<p>This process is analogous to updating the width of a map.</p>
<p>Modifying the height of a map will alter its top side. A larger height expands the map from the top side and adds empty and transparent tiles, while a smaller height removes a part of the top side of the map causing a loss of tiles.</p>
<p>It is first needed to retrieve the location of the first map by reading four bytes from the twelfth byte of the map archive. Next, the height, located just after the width of the map, and the size of the map, located after the the height of the map, are updated. Finally, the map is shrunken or expanded according to the provided height.</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="setheight.svg" style="pointer-events: none;"></object>
<div class="caption">
Height of a map</div></div>
   <h2><a class="anchor" id="autotoc_md28"></a>
Replace tiles</h2>
<p>Replacing the tiles of a map involves to update the tile paths, the offset of the first properties of a tile and the offset of the first map.</p>
<p>The tiles of the map are replaced only if the provided properties contains at least the same amount of tiles.</p>
<p>See the graph below for an overview of the involved operations:</p>
<div class="image">
<object type="image/svg+xml" data="setobjects.svg" style="pointer-events: none;"></object>
<div class="caption">
Replace tiles</div></div>
   <h2><a class="anchor" id="autotoc_md29"></a>
Remove tiles</h2>
<p>Removing unused tiles of a map archive involves to update the tile paths, the offset of the first properties of a tile, the offset of the first map and the map data referencing the tiles.</p>
<div class="image">
<object type="image/svg+xml" data="pruneobjects.svg" style="pointer-events: none;"></object>
<div class="caption">
Remove tiles</div></div>
   <h1><a class="anchor" id="autotoc_md30"></a>
Command line parsers</h1>
<p>The command line parsers are implemented with the help of <a href="https://www.gnu.org/software/gengetopt/gengetopt.html">Gengetopt</a>.</p>
<p>The first parser <a class="el" href="cmdline_8h.html">cmdline.h</a> is main one and is dedicated to parse all the options listed below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Long options </th><th class="markdownTableHeadCenter">Short options </th><th class="markdownTableHeadCenter">Mandatory </th><th class="markdownTableHeadLeft">Parameters </th><th class="markdownTableHeadLeft">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--help</code> </td><td class="markdownTableBodyCenter"><code>None</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Displays the usage of the program.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--version</code> </td><td class="markdownTableBodyCenter"><code>-V</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Displays the version of the program.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--file</code> </td><td class="markdownTableBodyCenter"><code>-f</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>String</code> </td><td class="markdownTableBodyLeft">Map archive.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--getwidth</code> </td><td class="markdownTableBodyCenter"><code>-w</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Gets the width of a map.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--getheight</code> </td><td class="markdownTableBodyCenter"><code>-h</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Gets the height of a map.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--getobjetcs</code> </td><td class="markdownTableBodyCenter"><code>-o</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Gets the number of tiles of a map.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--getinfo</code> </td><td class="markdownTableBodyCenter"><code>-i</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Gets the width, the height and the number of tiles of a map.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--setwidth</code> </td><td class="markdownTableBodyCenter"><code>-W</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>Integer</code> </td><td class="markdownTableBodyLeft">Sets the width of a map.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--setheight</code> </td><td class="markdownTableBodyCenter"><code>-H</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>Integer</code> </td><td class="markdownTableBodyLeft">sets the height of a map.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--setobjects</code> </td><td class="markdownTableBodyCenter"><code>-O</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>Sring</code> </td><td class="markdownTableBodyLeft">Replaces the tile of a map.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--pruneobjects</code> </td><td class="markdownTableBodyCenter"><code>-p</code> </td><td class="markdownTableBodyCenter"><code>No</code> </td><td class="markdownTableBodyLeft"><code>None</code> </td><td class="markdownTableBodyLeft">Remove unused tiles from a map.  </td></tr>
</table>
<p>The second parser <code><a class="el" href="cmdlineobjectproperties_8h.html" title="The header file for the command line option parser generated by GNU Gengetopt version 2....">cmdlineobjectproperties.h</a></code> is used as a sub-parser for the <code>--setobjects</code> option and requires the following arguments:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Long options </th><th class="markdownTableHeadCenter">Short options </th><th class="markdownTableHeadCenter">Mandatory </th><th class="markdownTableHeadLeft">Parameters </th><th class="markdownTableHeadLeft">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--path</code> </td><td class="markdownTableBodyCenter"><code>-p</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>String</code> </td><td class="markdownTableBodyLeft">The path to a tile.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--frames</code> </td><td class="markdownTableBodyCenter"><code>-f</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>Integer</code> </td><td class="markdownTableBodyLeft">The number of frames of the tile.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--solidity</code> </td><td class="markdownTableBodyCenter"><code>-s</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>Enumeration {solid, semi-solid, air}</code> </td><td class="markdownTableBodyLeft">Solidity property of the tile.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--destructible</code> </td><td class="markdownTableBodyCenter"><code>-d</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>Enumeration {destructile, not-destrucible}</code> </td><td class="markdownTableBodyLeft">Destructible property of the tile.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>--collectible</code> </td><td class="markdownTableBodyCenter"><code>-c</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>Enumeration {collectible, not-collectible}</code> </td><td class="markdownTableBodyLeft">Collectible property of the tile.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>--generator</code> </td><td class="markdownTableBodyCenter"><code>-g</code> </td><td class="markdownTableBodyCenter"><code>Yes</code> </td><td class="markdownTableBodyLeft"><code>Enumeration {generator, not-generator}</code> </td><td class="markdownTableBodyLeft">Generator property of the tile.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md31"></a>
Potential improvements</h1>
<p>Here are some potential improvements:</p>
<ul>
<li>Use a buffer in order to limit the invokation of the <a href="https://man7.org/linux/man-pages/man2/read.2.html">read</a> and <a href="https://man7.org/linux/man-pages/man2/write.2.html">write</a> system calls;</li>
<li>Extend the map archives so that they contain multiple maps (the <code>libgame.a</code> static library must be disassembled).</li>
<li>Extend the map archives so that they contain multiple directories (possible by using a k-ary tree). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="project_page.html">Project</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
